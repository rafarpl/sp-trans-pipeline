# Prometheus Configuration for SPTrans Pipeline Monitoring

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: 'sptrans-pipeline'
    environment: 'production'

# Alertmanager configuration (opcional - pode adicionar depois)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets: ['alertmanager:9093']

# Rule files
# rule_files:
#   - "alerts/*.yml"

# Scrape configurations
scrape_configs:
  # ==========================================
  # PROMETHEUS SELF-MONITORING
  # ==========================================
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'

  # ==========================================
  # POSTGRESQL EXPORTER
  # ==========================================
  - job_name: 'postgres'
    static_configs:
      - targets: ['postgres:5432']
        labels:
          service: 'postgresql'
          layer: 'serving'

  # ==========================================
  # REDIS EXPORTER
  # ==========================================
  - job_name: 'redis'
    static_configs:
      - targets: ['redis:6379']
        labels:
          service: 'redis'
          layer: 'cache'

  # ==========================================
  # MINIO METRICS
  # ==========================================
  - job_name: 'minio'
    metrics_path: /minio/v2/metrics/cluster
    static_configs:
      - targets: ['minio:9000']
        labels:
          service: 'minio'
          layer: 'storage'

  # ==========================================
  # SPARK MASTER
  # ==========================================
  - job_name: 'spark-master'
    static_configs:
      - targets: ['spark-master:8080']
        labels:
          service: 'spark'
          component: 'master'
          layer: 'processing'

  # ==========================================
  # SPARK WORKERS
  # ==========================================
  - job_name: 'spark-workers'
    static_configs:
      - targets:
          - 'spark-worker-1:8081'
          - 'spark-worker-2:8081'
        labels:
          service: 'spark'
          component: 'worker'
          layer: 'processing'

  # ==========================================
  # AIRFLOW WEBSERVER
  # ==========================================
  - job_name: 'airflow-webserver'
    metrics_path: /admin/metrics
    static_configs:
      - targets: ['airflow-webserver:8080']
        labels:
          service: 'airflow'
          component: 'webserver'
          layer: 'orchestration'

  # ==========================================
  # AIRFLOW SCHEDULER
  # ==========================================
  - job_name: 'airflow-scheduler'
    static_configs:
      - targets: ['airflow-scheduler:8974']
        labels:
          service: 'airflow'
          component: 'scheduler'
          layer: 'orchestration'

  # ==========================================
  # SUPERSET
  # ==========================================
  - job_name: 'superset'
    static_configs:
      - targets: ['superset:8088']
        labels:
          service: 'superset'
          layer: 'visualization'

  # ==========================================
  # GRAFANA
  # ==========================================
  - job_name: 'grafana'
    static_configs:
      - targets: ['grafana:3000']
        labels:
          service: 'grafana'
          layer: 'visualization'

  # ==========================================
  # CUSTOM APPLICATION METRICS
  # ==========================================
  - job_name: 'sptrans-api-client'
    static_configs:
      - targets: ['airflow-worker:9091']
        labels:
          service: 'sptrans-api'
          layer: 'ingestion'

  - job_name: 'data-quality-checks'
    static_configs:
      - targets: ['airflow-worker:9092']
        labels:
          service: 'data-quality'
          layer: 'monitoring'
