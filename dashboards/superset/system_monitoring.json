{
  "dashboard_title": "SPTrans Pipeline - System Monitoring",
  "description": "Dashboard de monitoramento em tempo real do pipeline de dados SPTrans",
  "slug": "sptrans-system-monitoring",
  "published": true,
  "position_json": "{\"CHART-1\":{\"children\":[],\"id\":\"CHART-1\",\"meta\":{\"chartId\":1,\"height\":50,\"sliceName\":\"Pipeline Status - Execuções por Status\",\"width\":4},\"parents\":[\"ROOT_ID\",\"GRID_ID\",\"ROW-1\"],\"type\":\"CHART\"},\"CHART-2\":{\"children\":[],\"id\":\"CHART-2\",\"meta\":{\"chartId\":2,\"height\":50,\"sliceName\":\"Latência Média por Stage\",\"width\":4},\"parents\":[\"ROOT_ID\",\"GRID_ID\",\"ROW-1\"],\"type\":\"CHART\"},\"CHART-3\":{\"children\":[],\"id\":\"CHART-3\",\"meta\":{\"chartId\":3,\"height\":50,\"sliceName\":\"Volume de Dados Processados\",\"width\":4},\"parents\":[\"ROOT_ID\",\"GRID_ID\",\"ROW-1\"],\"type\":\"CHART\"},\"CHART-4\":{\"children\":[],\"id\":\"CHART-4\",\"meta\":{\"chartId\":4,\"height\":50,\"sliceName\":\"Taxa de Sucesso - 24h\",\"width\":6},\"parents\":[\"ROOT_ID\",\"GRID_ID\",\"ROW-2\"],\"type\":\"CHART\"},\"CHART-5\":{\"children\":[],\"id\":\"CHART-5\",\"meta\":{\"chartId\":5,\"height\":50,\"sliceName\":\"SLA Compliance\",\"width\":6},\"parents\":[\"ROOT_ID\",\"GRID_ID\",\"ROW-2\"],\"type\":\"CHART\"},\"CHART-6\":{\"children\":[],\"id\":\"CHART-6\",\"meta\":{\"chartId\":6,\"height\":50,\"sliceName\":\"Execuções por Hora\",\"width\":12},\"parents\":[\"ROOT_ID\",\"GRID_ID\",\"ROW-3\"],\"type\":\"CHART\"},\"CHART-7\":{\"children\":[],\"id\":\"CHART-7\",\"meta\":{\"chartId\":7,\"height\":50,\"sliceName\":\"Top 10 Jobs Mais Lentos\",\"width\":6},\"parents\":[\"ROOT_ID\",\"GRID_ID\",\"ROW-4\"],\"type\":\"CHART\"},\"CHART-8\":{\"children\":[],\"id\":\"CHART-8\",\"meta\":{\"chartId\":8,\"height\":50,\"sliceName\":\"Falhas Recentes\",\"width\":6},\"parents\":[\"ROOT_ID\",\"GRID_ID\",\"ROW-4\"],\"type\":\"CHART\"},\"CHART-9\":{\"children\":[],\"id\":\"CHART-9\",\"meta\":{\"chartId\":9,\"height\":50,\"sliceName\":\"CPU e Memória - Spark\",\"width\":6},\"parents\":[\"ROOT_ID\",\"GRID_ID\",\"ROW-5\"],\"type\":\"CHART\"},\"CHART-10\":{\"children\":[],\"id\":\"CHART-10\",\"meta\":{\"chartId\":10,\"height\":50,\"sliceName\":\"Uso de Disco - MinIO\",\"width\":6},\"parents\":[\"ROOT_ID\",\"GRID_ID\",\"ROW-5\"],\"type\":\"CHART\"},\"GRID_ID\":{\"children\":[\"ROW-1\",\"ROW-2\",\"ROW-3\",\"ROW-4\",\"ROW-5\"],\"id\":\"GRID_ID\",\"parents\":[\"ROOT_ID\"],\"type\":\"GRID\"},\"HEADER_ID\":{\"id\":\"HEADER_ID\",\"meta\":{\"text\":\"SPTrans Pipeline - System Monitoring\"},\"type\":\"HEADER\"},\"ROOT_ID\":{\"children\":[\"GRID_ID\"],\"id\":\"ROOT_ID\",\"type\":\"ROOT\"},\"ROW-1\":{\"children\":[\"CHART-1\",\"CHART-2\",\"CHART-3\"],\"id\":\"ROW-1\",\"meta\":{\"background\":\"BACKGROUND_TRANSPARENT\"},\"parents\":[\"ROOT_ID\",\"GRID_ID\"],\"type\":\"ROW\"},\"ROW-2\":{\"children\":[\"CHART-4\",\"CHART-5\"],\"id\":\"ROW-2\",\"meta\":{\"background\":\"BACKGROUND_TRANSPARENT\"},\"parents\":[\"ROOT_ID\",\"GRID_ID\"],\"type\":\"ROW\"},\"ROW-3\":{\"children\":[\"CHART-6\"],\"id\":\"ROW-3\",\"meta\":{\"background\":\"BACKGROUND_TRANSPARENT\"},\"parents\":[\"ROOT_ID\",\"GRID_ID\"],\"type\":\"ROW\"},\"ROW-4\":{\"children\":[\"CHART-7\",\"CHART-8\"],\"id\":\"ROW-4\",\"meta\":{\"background\":\"BACKGROUND_TRANSPARENT\"},\"parents\":[\"ROOT_ID\",\"GRID_ID\"],\"type\":\"ROW\"},\"ROW-5\":{\"children\":[\"CHART-9\",\"CHART-10\"],\"id\":\"ROW-5\",\"meta\":{\"background\":\"BACKGROUND_TRANSPARENT\"},\"parents\":[\"ROOT_ID\",\"GRID_ID\"],\"type\":\"ROW\"}}",
  "json_metadata": "{\"color_scheme\":\"supersetColors\",\"label_colors\":{},\"refresh_frequency\":60,\"timed_refresh_immune_slices\":[],\"expanded_slices\":{},\"filter_scopes\":{},\"default_filters\":\"{}\"}",
  "slices": [
    {
      "slice_name": "Pipeline Status - Execuções por Status",
      "viz_type": "pie",
      "datasource_name": "pipeline_metrics",
      "params": {
        "viz_type": "pie",
        "datasource": "pipeline_metrics",
        "groupby": ["status"],
        "metric": "COUNT(*)",
        "adhoc_filters": [
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "execution_date",
            "operator": "TEMPORAL_RANGE",
            "comparator": "Last 24 hours"
          }
        ],
        "row_limit": 10,
        "pie_label_type": "key_value",
        "donut": true,
        "show_legend": true,
        "color_scheme": "supersetColors"
      },
      "description": "Distribuição de execuções do pipeline por status nas últimas 24 horas"
    },
    {
      "slice_name": "Latência Média por Stage",
      "viz_type": "bar",
      "datasource_name": "pipeline_metrics",
      "params": {
        "viz_type": "bar",
        "datasource": "pipeline_metrics",
        "groupby": ["stage"],
        "metrics": ["AVG(processing_time_seconds)"],
        "adhoc_filters": [
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "execution_date",
            "operator": "TEMPORAL_RANGE",
            "comparator": "Last 7 days"
          }
        ],
        "row_limit": 10,
        "color_scheme": "supersetColors",
        "show_legend": false,
        "x_axis_label": "Stage",
        "y_axis_label": "Latência Média (s)",
        "y_axis_format": ".2f"
      },
      "description": "Latência média de processamento por stage nos últimos 7 dias"
    },
    {
      "slice_name": "Volume de Dados Processados",
      "viz_type": "big_number_total",
      "datasource_name": "pipeline_metrics",
      "params": {
        "viz_type": "big_number_total",
        "datasource": "pipeline_metrics",
        "metric": "SUM(records_processed)",
        "adhoc_filters": [
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "execution_date",
            "operator": "TEMPORAL_RANGE",
            "comparator": "Today"
          }
        ],
        "subheader": "Registros processados hoje",
        "y_axis_format": ",.0f"
      },
      "description": "Total de registros processados hoje"
    },
    {
      "slice_name": "Taxa de Sucesso - 24h",
      "viz_type": "gauge_chart",
      "datasource_name": "pipeline_metrics",
      "params": {
        "viz_type": "gauge_chart",
        "datasource": "pipeline_metrics",
        "metric": {
          "expressionType": "SQL",
          "sqlExpression": "100.0 * SUM(CASE WHEN status = 'success' THEN 1 ELSE 0 END) / COUNT(*)",
          "label": "Taxa de Sucesso (%)"
        },
        "adhoc_filters": [
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "execution_date",
            "operator": "TEMPORAL_RANGE",
            "comparator": "Last 24 hours"
          }
        ],
        "min_val": 0,
        "max_val": 100,
        "color_scheme": "supersetColors"
      },
      "description": "Percentual de execuções bem-sucedidas nas últimas 24 horas"
    },
    {
      "slice_name": "SLA Compliance",
      "viz_type": "gauge_chart",
      "datasource_name": "pipeline_metrics",
      "params": {
        "viz_type": "gauge_chart",
        "datasource": "pipeline_metrics",
        "metric": {
          "expressionType": "SQL",
          "sqlExpression": "100.0 * SUM(CASE WHEN status = 'success' AND processing_time_seconds <= 120 THEN 1 ELSE 0 END) / COUNT(*)",
          "label": "SLA Compliance (%)"
        },
        "adhoc_filters": [
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "execution_date",
            "operator": "TEMPORAL_RANGE",
            "comparator": "Last 7 days"
          }
        ],
        "min_val": 0,
        "max_val": 100,
        "color_scheme": "supersetColors"
      },
      "description": "Percentual de execuções que atendem ao SLA (< 120s) nos últimos 7 dias"
    },
    {
      "slice_name": "Execuções por Hora",
      "viz_type": "line",
      "datasource_name": "pipeline_metrics",
      "params": {
        "viz_type": "line",
        "datasource": "pipeline_metrics",
        "granularity_sqla": "execution_date",
        "time_grain_sqla": "PT1H",
        "metrics": ["COUNT(*)"],
        "adhoc_filters": [
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "execution_date",
            "operator": "TEMPORAL_RANGE",
            "comparator": "Last 24 hours"
          }
        ],
        "row_limit": 50000,
        "color_scheme": "supersetColors",
        "show_legend": true,
        "x_axis_label": "Hora",
        "y_axis_label": "Número de Execuções",
        "line_interpolation": "linear",
        "show_markers": true
      },
      "description": "Número de execuções por hora nas últimas 24 horas"
    },
    {
      "slice_name": "Top 10 Jobs Mais Lentos",
      "viz_type": "table",
      "datasource_name": "pipeline_metrics",
      "params": {
        "viz_type": "table",
        "datasource": "pipeline_metrics",
        "groupby": ["job_name", "stage"],
        "metrics": [
          "AVG(processing_time_seconds)",
          "MAX(processing_time_seconds)",
          "COUNT(*)"
        ],
        "adhoc_filters": [
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "execution_date",
            "operator": "TEMPORAL_RANGE",
            "comparator": "Last 7 days"
          }
        ],
        "row_limit": 10,
        "order_desc": true,
        "orderby": [["AVG(processing_time_seconds)", false]],
        "table_timestamp_format": "%Y-%m-%d %H:%M:%S",
        "show_cell_bars": true
      },
      "description": "Top 10 jobs com maior tempo médio de processamento"
    },
    {
      "slice_name": "Falhas Recentes",
      "viz_type": "table",
      "datasource_name": "pipeline_metrics",
      "params": {
        "viz_type": "table",
        "datasource": "pipeline_metrics",
        "groupby": ["execution_date", "job_name", "stage", "error_message"],
        "metrics": ["COUNT(*)"],
        "adhoc_filters": [
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "status",
            "operator": "==",
            "comparator": "failed"
          },
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "execution_date",
            "operator": "TEMPORAL_RANGE",
            "comparator": "Last 24 hours"
          }
        ],
        "row_limit": 10,
        "order_desc": true,
        "orderby": [["execution_date", false]],
        "table_timestamp_format": "%Y-%m-%d %H:%M:%S"
      },
      "description": "Lista de falhas recentes nas últimas 24 horas"
    },
    {
      "slice_name": "CPU e Memória - Spark",
      "viz_type": "mixed_timeseries",
      "datasource_name": "system_metrics",
      "params": {
        "viz_type": "mixed_timeseries",
        "datasource": "system_metrics",
        "granularity_sqla": "timestamp",
        "time_grain_sqla": "PT5M",
        "metrics": [
          {
            "expressionType": "SIMPLE",
            "column": {
              "column_name": "cpu_usage_percent"
            },
            "aggregate": "AVG",
            "label": "CPU (%)"
          },
          {
            "expressionType": "SIMPLE",
            "column": {
              "column_name": "memory_usage_percent"
            },
            "aggregate": "AVG",
            "label": "Memória (%)"
          }
        ],
        "adhoc_filters": [
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "service_name",
            "operator": "==",
            "comparator": "spark"
          },
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "timestamp",
            "operator": "TEMPORAL_RANGE",
            "comparator": "Last 6 hours"
          }
        ],
        "color_scheme": "supersetColors",
        "show_legend": true,
        "x_axis_label": "Tempo",
        "y_axis_label": "Utilização (%)",
        "y_axis_bounds": [0, 100]
      },
      "description": "Uso de CPU e memória do Spark nas últimas 6 horas"
    },
    {
      "slice_name": "Uso de Disco - MinIO",
      "viz_type": "line",
      "datasource_name": "system_metrics",
      "params": {
        "viz_type": "line",
        "datasource": "system_metrics",
        "granularity_sqla": "timestamp",
        "time_grain_sqla": "PT1H",
        "metrics": [
          {
            "expressionType": "SQL",
            "sqlExpression": "AVG(disk_usage_gb)",
            "label": "Uso de Disco (GB)"
          }
        ],
        "adhoc_filters": [
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "service_name",
            "operator": "==",
            "comparator": "minio"
          },
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "timestamp",
            "operator": "TEMPORAL_RANGE",
            "comparator": "Last 7 days"
          }
        ],
        "color_scheme": "supersetColors",
        "show_legend": true,
        "x_axis_label": "Data",
        "y_axis_label": "Uso de Disco (GB)",
        "line_interpolation": "linear",
        "show_markers": false
      },
      "description": "Evolução do uso de disco do MinIO nos últimos 7 dias"
    }
  ],
  "metadata": {
    "version": "1.0",
    "created_by": "SPTrans Pipeline Team",
    "created_at": "2025-01-29",
    "description": "Dashboard completo de monitoramento de sistema do pipeline SPTrans",
    "tags": ["monitoring", "system", "performance", "sla"],
    "refresh_interval_seconds": 60,
    "filters": [
      {
        "name": "time_range",
        "type": "temporal",
        "default": "Last 24 hours"
      },
      {
        "name": "stage",
        "type": "categorical",
        "values": ["ingestion", "bronze_to_silver", "silver_to_gold", "gold_to_serving"]
      },
      {
        "name": "status",
        "type": "categorical",
        "values": ["success", "failed", "running"]
      }
    ],
    "alerts": [
      {
        "name": "High Failure Rate",
        "condition": "failure_rate > 5%",
        "severity": "critical",
        "notification_channels": ["email", "slack"]
      },
      {
        "name": "SLA Breach",
        "condition": "sla_compliance < 95%",
        "severity": "high",
        "notification_channels": ["email", "slack"]
      },
      {
        "name": "High Latency",
        "condition": "avg_latency > 120s",
        "severity": "medium",
        "notification_channels": ["slack"]
      }
    ],
    "notes": [
      "Dashboard atualizado automaticamente a cada 60 segundos",
      "Métricas baseadas nas tabelas pipeline_metrics e system_metrics",
      "SLA definido como processamento em até 120 segundos",
      "Para análise detalhada, consulte os logs no Grafana"
    ]
  }
}
