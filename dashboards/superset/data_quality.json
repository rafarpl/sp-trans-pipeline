{
  "dashboard_title": "SPTrans Pipeline - Data Quality",
  "description": "Dashboard de monitoramento da qualidade de dados do pipeline SPTrans",
  "slug": "sptrans-data-quality",
  "published": true,
  "position_json": "{\"CHART-1\":{\"children\":[],\"id\":\"CHART-1\",\"meta\":{\"chartId\":1,\"height\":50,\"sliceName\":\"Score Geral de Qualidade\",\"width\":3},\"parents\":[\"ROOT_ID\",\"GRID_ID\",\"ROW-1\"],\"type\":\"CHART\"},\"CHART-2\":{\"children\":[],\"id\":\"CHART-2\",\"meta\":{\"chartId\":2,\"height\":50,\"sliceName\":\"Completude\",\"width\":3},\"parents\":[\"ROOT_ID\",\"GRID_ID\",\"ROW-1\"],\"type\":\"CHART\"},\"CHART-3\":{\"children\":[],\"id\":\"CHART-3\",\"meta\":{\"chartId\":3,\"height\":50,\"sliceName\":\"Acurácia\",\"width\":3},\"parents\":[\"ROOT_ID\",\"GRID_ID\",\"ROW-1\"],\"type\":\"CHART\"},\"CHART-4\":{\"children\":[],\"id\":\"CHART-4\",\"meta\":{\"chartId\":4,\"height\":50,\"sliceName\":\"Consistência\",\"width\":3},\"parents\":[\"ROOT_ID\",\"GRID_ID\",\"ROW-1\"],\"type\":\"CHART\"},\"CHART-5\":{\"children\":[],\"id\":\"CHART-5\",\"meta\":{\"chartId\":5,\"height\":50,\"sliceName\":\"Evolução da Qualidade - 30 dias\",\"width\":12},\"parents\":[\"ROOT_ID\",\"GRID_ID\",\"ROW-2\"],\"type\":\"CHART\"},\"CHART-6\":{\"children\":[],\"id\":\"CHART-6\",\"meta\":{\"chartId\":6,\"height\":50,\"sliceName\":\"Registros com Problemas por Tipo\",\"width\":6},\"parents\":[\"ROOT_ID\",\"GRID_ID\",\"ROW-3\"],\"type\":\"CHART\"},\"CHART-7\":{\"children\":[],\"id\":\"CHART-7\",\"meta\":{\"chartId\":7,\"height\":50,\"sliceName\":\"Alertas de Qualidade\",\"width\":6},\"parents\":[\"ROOT_ID\",\"GRID_ID\",\"ROW-3\"],\"type\":\"CHART\"},\"CHART-8\":{\"children\":[],\"id\":\"CHART-8\",\"meta\":{\"chartId\":8,\"height\":50,\"sliceName\":\"Qualidade por Layer\",\"width\":6},\"parents\":[\"ROOT_ID\",\"GRID_ID\",\"ROW-4\"],\"type\":\"CHART\"},\"CHART-9\":{\"children\":[],\"id\":\"CHART-9\",\"meta\":{\"chartId\":9,\"height\":50,\"sliceName\":\"Distribuição de Coordenadas\",\"width\":6},\"parents\":[\"ROOT_ID\",\"GRID_ID\",\"ROW-4\"],\"type\":\"CHART\"},\"CHART-10\":{\"children\":[],\"id\":\"CHART-10\",\"meta\":{\"chartId\":10,\"height\":50,\"sliceName\":\"Taxa de Duplicação\",\"width\":4},\"parents\":[\"ROOT_ID\",\"GRID_ID\",\"ROW-5\"],\"type\":\"CHART\"},\"CHART-11\":{\"children\":[],\"id\":\"CHART-11\",\"meta\":{\"chartId\":11,\"height\":50,\"sliceName\":\"Valores Nulos por Campo\",\"width\":4},\"parents\":[\"ROOT_ID\",\"GRID_ID\",\"ROW-5\"],\"type\":\"CHART\"},\"CHART-12\":{\"children\":[],\"id\":\"CHART-12\",\"meta\":{\"chartId\":12,\"height\":50,\"sliceName\":\"Atualidade dos Dados\",\"width\":4},\"parents\":[\"ROOT_ID\",\"GRID_ID\",\"ROW-5\"],\"type\":\"CHART\"},\"GRID_ID\":{\"children\":[\"ROW-1\",\"ROW-2\",\"ROW-3\",\"ROW-4\",\"ROW-5\"],\"id\":\"GRID_ID\",\"parents\":[\"ROOT_ID\"],\"type\":\"GRID\"},\"HEADER_ID\":{\"id\":\"HEADER_ID\",\"meta\":{\"text\":\"SPTrans Pipeline - Data Quality\"},\"type\":\"HEADER\"},\"ROOT_ID\":{\"children\":[\"GRID_ID\"],\"id\":\"ROOT_ID\",\"type\":\"ROOT\"},\"ROW-1\":{\"children\":[\"CHART-1\",\"CHART-2\",\"CHART-3\",\"CHART-4\"],\"id\":\"ROW-1\",\"meta\":{\"background\":\"BACKGROUND_TRANSPARENT\"},\"parents\":[\"ROOT_ID\",\"GRID_ID\"],\"type\":\"ROW\"},\"ROW-2\":{\"children\":[\"CHART-5\"],\"id\":\"ROW-2\",\"meta\":{\"background\":\"BACKGROUND_TRANSPARENT\"},\"parents\":[\"ROOT_ID\",\"GRID_ID\"],\"type\":\"ROW\"},\"ROW-3\":{\"children\":[\"CHART-6\",\"CHART-7\"],\"id\":\"ROW-3\",\"meta\":{\"background\":\"BACKGROUND_TRANSPARENT\"},\"parents\":[\"ROOT_ID\",\"GRID_ID\"],\"type\":\"ROW\"},\"ROW-4\":{\"children\":[\"CHART-8\",\"CHART-9\"],\"id\":\"ROW-4\",\"meta\":{\"background\":\"BACKGROUND_TRANSPARENT\"},\"parents\":[\"ROOT_ID\",\"GRID_ID\"],\"type\":\"ROW\"},\"ROW-5\":{\"children\":[\"CHART-10\",\"CHART-11\",\"CHART-12\"],\"id\":\"ROW-5\",\"meta\":{\"background\":\"BACKGROUND_TRANSPARENT\"},\"parents\":[\"ROOT_ID\",\"GRID_ID\"],\"type\":\"ROW\"}}",
  "json_metadata": "{\"color_scheme\":\"supersetColors\",\"label_colors\":{},\"refresh_frequency\":300,\"timed_refresh_immune_slices\":[],\"expanded_slices\":{},\"filter_scopes\":{},\"default_filters\":\"{}\"}",
  "slices": [
    {
      "slice_name": "Score Geral de Qualidade",
      "viz_type": "gauge_chart",
      "datasource_name": "data_quality_metrics",
      "params": {
        "viz_type": "gauge_chart",
        "datasource": "data_quality_metrics",
        "metric": {
          "expressionType": "SQL",
          "sqlExpression": "AVG((completeness_score + accuracy_score + consistency_score + timeliness_score) / 4)",
          "label": "Score Geral (%)"
        },
        "adhoc_filters": [
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "check_date",
            "operator": "TEMPORAL_RANGE",
            "comparator": "Today"
          }
        ],
        "min_val": 0,
        "max_val": 100,
        "color_scheme": "supersetColors"
      },
      "description": "Score médio geral de qualidade dos dados (média das 4 dimensões)"
    },
    {
      "slice_name": "Completude",
      "viz_type": "gauge_chart",
      "datasource_name": "data_quality_metrics",
      "params": {
        "viz_type": "gauge_chart",
        "datasource": "data_quality_metrics",
        "metric": "AVG(completeness_score)",
        "adhoc_filters": [
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "check_date",
            "operator": "TEMPORAL_RANGE",
            "comparator": "Today"
          }
        ],
        "min_val": 0,
        "max_val": 100,
        "color_scheme": "supersetColors"
      },
      "description": "Score de completude - percentual de campos não nulos"
    },
    {
      "slice_name": "Acurácia",
      "viz_type": "gauge_chart",
      "datasource_name": "data_quality_metrics",
      "params": {
        "viz_type": "gauge_chart",
        "datasource": "data_quality_metrics",
        "metric": "AVG(accuracy_score)",
        "adhoc_filters": [
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "check_date",
            "operator": "TEMPORAL_RANGE",
            "comparator": "Today"
          }
        ],
        "min_val": 0,
        "max_val": 100,
        "color_scheme": "supersetColors"
      },
      "description": "Score de acurácia - percentual de dados corretos e válidos"
    },
    {
      "slice_name": "Consistência",
      "viz_type": "gauge_chart",
      "datasource_name": "data_quality_metrics",
      "params": {
        "viz_type": "gauge_chart",
        "datasource": "data_quality_metrics",
        "metric": "AVG(consistency_score)",
        "adhoc_filters": [
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "check_date",
            "operator": "TEMPORAL_RANGE",
            "comparator": "Today"
          }
        ],
        "min_val": 0,
        "max_val": 100,
        "color_scheme": "supersetColors"
      },
      "description": "Score de consistência - ausência de duplicatas e conflitos"
    },
    {
      "slice_name": "Evolução da Qualidade - 30 dias",
      "viz_type": "line",
      "datasource_name": "data_quality_metrics",
      "params": {
        "viz_type": "line",
        "datasource": "data_quality_metrics",
        "granularity_sqla": "check_date",
        "time_grain_sqla": "P1D",
        "metrics": [
          {
            "expressionType": "SIMPLE",
            "column": {
              "column_name": "completeness_score"
            },
            "aggregate": "AVG",
            "label": "Completude"
          },
          {
            "expressionType": "SIMPLE",
            "column": {
              "column_name": "accuracy_score"
            },
            "aggregate": "AVG",
            "label": "Acurácia"
          },
          {
            "expressionType": "SIMPLE",
            "column": {
              "column_name": "consistency_score"
            },
            "aggregate": "AVG",
            "label": "Consistência"
          },
          {
            "expressionType": "SIMPLE",
            "column": {
              "column_name": "timeliness_score"
            },
            "aggregate": "AVG",
            "label": "Atualidade"
          }
        ],
        "adhoc_filters": [
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "check_date",
            "operator": "TEMPORAL_RANGE",
            "comparator": "Last 30 days"
          }
        ],
        "color_scheme": "supersetColors",
        "show_legend": true,
        "x_axis_label": "Data",
        "y_axis_label": "Score (%)",
        "y_axis_bounds": [0, 100],
        "line_interpolation": "linear",
        "show_markers": true
      },
      "description": "Evolução temporal das 4 dimensões de qualidade nos últimos 30 dias"
    },
    {
      "slice_name": "Registros com Problemas por Tipo",
      "viz_type": "pie",
      "datasource_name": "data_quality_issues",
      "params": {
        "viz_type": "pie",
        "datasource": "data_quality_issues",
        "groupby": ["issue_type"],
        "metric": "COUNT(*)",
        "adhoc_filters": [
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "detected_at",
            "operator": "TEMPORAL_RANGE",
            "comparator": "Last 24 hours"
          }
        ],
        "row_limit": 10,
        "pie_label_type": "key_percent",
        "donut": false,
        "show_legend": true,
        "color_scheme": "supersetColors"
      },
      "description": "Distribuição de problemas de qualidade por tipo nas últimas 24 horas"
    },
    {
      "slice_name": "Alertas de Qualidade",
      "viz_type": "table",
      "datasource_name": "data_quality_alerts",
      "params": {
        "viz_type": "table",
        "datasource": "data_quality_alerts",
        "groupby": ["alert_time", "alert_type", "severity", "table_name", "description"],
        "metrics": ["COUNT(*)"],
        "adhoc_filters": [
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "alert_time",
            "operator": "TEMPORAL_RANGE",
            "comparator": "Last 24 hours"
          },
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "status",
            "operator": "==",
            "comparator": "active"
          }
        ],
        "row_limit": 20,
        "order_desc": true,
        "orderby": [["alert_time", false]],
        "table_timestamp_format": "%Y-%m-%d %H:%M:%S"
      },
      "description": "Lista de alertas ativos de qualidade de dados"
    },
    {
      "slice_name": "Qualidade por Layer",
      "viz_type": "bar",
      "datasource_name": "data_quality_metrics",
      "params": {
        "viz_type": "bar",
        "datasource": "data_quality_metrics",
        "groupby": ["layer"],
        "metrics": [
          {
            "expressionType": "SQL",
            "sqlExpression": "AVG((completeness_score + accuracy_score + consistency_score + timeliness_score) / 4)",
            "label": "Score Médio"
          }
        ],
        "adhoc_filters": [
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "check_date",
            "operator": "TEMPORAL_RANGE",
            "comparator": "Today"
          }
        ],
        "row_limit": 10,
        "color_scheme": "supersetColors",
        "show_legend": false,
        "x_axis_label": "Layer (Bronze/Silver/Gold)",
        "y_axis_label": "Score de Qualidade (%)",
        "y_axis_format": ".2f",
        "y_axis_bounds": [0, 100]
      },
      "description": "Score médio de qualidade por camada da arquitetura Medallion"
    },
    {
      "slice_name": "Distribuição de Coordenadas",
      "viz_type": "histogram",
      "datasource_name": "vehicle_positions",
      "params": {
        "viz_type": "histogram",
        "datasource": "vehicle_positions",
        "all_columns_x": "latitude",
        "adhoc_filters": [
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "timestamp",
            "operator": "TEMPORAL_RANGE",
            "comparator": "Today"
          },
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "latitude",
            "operator": "IS NOT NULL"
          }
        ],
        "row_limit": 10000,
        "x_axis_label": "Latitude",
        "y_axis_label": "Frequência",
        "normalize": false,
        "color_scheme": "supersetColors"
      },
      "description": "Distribuição de latitudes para validar se coordenadas estão dentro do perímetro esperado"
    },
    {
      "slice_name": "Taxa de Duplicação",
      "viz_type": "big_number",
      "datasource_name": "data_quality_metrics",
      "params": {
        "viz_type": "big_number",
        "datasource": "data_quality_metrics",
        "metric": {
          "expressionType": "SQL",
          "sqlExpression": "AVG(duplicate_records_percentage)",
          "label": "Taxa de Duplicação (%)"
        },
        "adhoc_filters": [
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "check_date",
            "operator": "TEMPORAL_RANGE",
            "comparator": "Today"
          }
        ],
        "subheader": "% de registros duplicados",
        "y_axis_format": ".2f",
        "compare_lag": 1,
        "compare_suffix": "vs dia anterior"
      },
      "description": "Percentual de registros duplicados detectados"
    },
    {
      "slice_name": "Valores Nulos por Campo",
      "viz_type": "bar",
      "datasource_name": "data_quality_field_stats",
      "params": {
        "viz_type": "bar",
        "datasource": "data_quality_field_stats",
        "groupby": ["field_name"],
        "metrics": ["AVG(null_percentage)"],
        "adhoc_filters": [
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "check_date",
            "operator": "TEMPORAL_RANGE",
            "comparator": "Today"
          },
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "null_percentage",
            "operator": ">",
            "comparator": 0
          }
        ],
        "row_limit": 20,
        "order_desc": true,
        "orderby": [["AVG(null_percentage)", false]],
        "color_scheme": "supersetColors",
        "show_legend": false,
        "x_axis_label": "Campo",
        "y_axis_label": "% de Valores Nulos",
        "y_axis_format": ".2f"
      },
      "description": "Campos com maior percentual de valores nulos"
    },
    {
      "slice_name": "Atualidade dos Dados",
      "viz_type": "big_number",
      "datasource_name": "vehicle_positions",
      "params": {
        "viz_type": "big_number",
        "datasource": "vehicle_positions",
        "metric": {
          "expressionType": "SQL",
          "sqlExpression": "ROUND(100.0 * COUNT(*) FILTER (WHERE timestamp >= NOW() - INTERVAL '1 hour') / NULLIF(COUNT(*), 0), 2)",
          "label": "Atualidade (%)"
        },
        "adhoc_filters": [
          {
            "clause": "WHERE",
            "expressionType": "SIMPLE",
            "subject": "timestamp",
            "operator": "TEMPORAL_RANGE",
            "comparator": "Today"
          }
        ],
        "subheader": "% de dados da última hora",
        "y_axis_format": ".2f",
        "compare_lag": 1,
        "compare_suffix": "vs dia anterior"
      },
      "description": "Percentual de dados coletados na última hora (indicador de atualidade)"
    }
  ],
  "metadata": {
    "version": "1.0",
    "created_by": "SPTrans Pipeline Team",
    "created_at": "2025-01-29",
    "description": "Dashboard completo de monitoramento da qualidade de dados do pipeline SPTrans",
    "tags": ["data-quality", "dq", "validation", "monitoring"],
    "refresh_interval_seconds": 300,
    "dimensions": {
      "completeness": {
        "name": "Completude",
        "description": "Percentual de campos não nulos",
        "threshold_warning": 95,
        "threshold_critical": 90
      },
      "accuracy": {
        "name": "Acurácia",
        "description": "Percentual de dados corretos e válidos",
        "threshold_warning": 95,
        "threshold_critical": 90
      },
      "consistency": {
        "name": "Consistência",
        "description": "Ausência de duplicatas e conflitos",
        "threshold_warning": 98,
        "threshold_critical": 95
      },
      "timeliness": {
        "name": "Atualidade",
        "description": "Percentual de dados recentes",
        "threshold_warning": 90,
        "threshold_critical": 80
      }
    },
    "issue_types": [
      {
        "type": "null_values",
        "name": "Valores Nulos",
        "severity": "medium",
        "description": "Campos obrigatórios com valores nulos"
      },
      {
        "type": "invalid_coordinates",
        "name": "Coordenadas Inválidas",
        "severity": "high",
        "description": "Coordenadas fora do perímetro de São Paulo"
      },
      {
        "type": "duplicates",
        "name": "Registros Duplicados",
        "severity": "medium",
        "description": "Registros com mesma chave primária"
      },
      {
        "type": "format_error",
        "name": "Erro de Formato",
        "severity": "medium",
        "description": "Dados com formato inválido"
      },
      {
        "type": "referential_integrity",
        "name": "Integridade Referencial",
        "severity": "high",
        "description": "Violação de chaves estrangeiras"
      },
      {
        "type": "outdated_data",
        "name": "Dados Desatualizados",
        "severity": "low",
        "description": "Dados com timestamp muito antigo"
      }
    ],
    "validation_rules": [
      {
        "rule": "latitude_range",
        "condition": "latitude BETWEEN -24.0 AND -23.3",
        "description": "Latitude deve estar dentro do perímetro de São Paulo"
      },
      {
        "rule": "longitude_range",
        "condition": "longitude BETWEEN -46.9 AND -46.3",
        "description": "Longitude deve estar dentro do perímetro de São Paulo"
      },
      {
        "rule": "timestamp_recent",
        "condition": "timestamp >= NOW() - INTERVAL '24 hours'",
        "description": "Dados devem ter no máximo 24 horas"
      },
      {
        "rule": "vehicle_id_not_null",
        "condition": "vehicle_id IS NOT NULL",
        "description": "Vehicle ID é campo obrigatório"
      },
      {
        "rule": "no_duplicates",
        "condition": "COUNT(*) = COUNT(DISTINCT (vehicle_id, timestamp))",
        "description": "Não deve haver registros duplicados"
      }
    ],
    "alerts": [
      {
        "name": "Low Completeness Score",
        "condition": "completeness_score < 95%",
        "severity": "high",
        "notification_channels": ["email", "slack"]
      },
      {
        "name": "High Duplicate Rate",
        "condition": "duplicate_records_percentage > 2%",
        "severity": "medium",
        "notification_channels": ["slack"]
      },
      {
        "name": "Invalid Coordinates Spike",
        "condition": "invalid_coordinates_count > 1000 per hour",
        "severity": "critical",
        "notification_channels": ["email", "slack", "pagerduty"]
      },
      {
        "name": "Data Freshness Issue",
        "condition": "timeliness_score < 80%",
        "severity": "high",
        "notification_channels": ["email", "slack"]
      },
      {
        "name": "Overall Quality Degradation",
        "condition": "overall_score < 90%",
        "severity": "critical",
        "notification_channels": ["email", "slack", "pagerduty"]
      }
    ],
    "sla": {
      "overall_quality_score": {
        "target": 95,
        "minimum": 90,
        "unit": "percentage"
      },
      "completeness": {
        "target": 98,
        "minimum": 95,
        "unit": "percentage"
      },
      "accuracy": {
        "target": 99,
        "minimum": 95,
        "unit": "percentage"
      },
      "consistency": {
        "target": 99,
        "minimum": 98,
        "unit": "percentage"
      },
      "timeliness": {
        "target": 95,
        "minimum": 85,
        "unit": "percentage"
      }
    },
    "notes": [
      "Dashboard atualizado a cada 5 minutos (300 segundos)",
      "Métricas baseadas nas tabelas data_quality_metrics, data_quality_issues e data_quality_alerts",
      "Score geral calculado como média das 4 dimensões de qualidade",
      "Coordenadas válidas: Lat [-24.0, -23.3] / Lon [-46.9, -46.3] (perímetro de São Paulo)",
      "Dados são considerados atualizados se coletados na última hora",
      "Para investigação detalhada de problemas, consulte a tabela data_quality_issues"
    ]
  }
}
